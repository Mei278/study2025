<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>质量检验系统</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }
        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .nav-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        .nav-card {
            background: white;
            padding: 40px 30px;
            border-radius: 10px;
            text-align: center;
            text-decoration: none;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #007bff;
            text-decoration: none;
            color: #333;
        }
        .nav-icon {
            font-size: 3em;
            margin-bottom: 20px;
            display: block;
        }
        .nav-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .nav-description {
            color: #666;
            line-height: 1.6;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        .system-info {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-top: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .system-info h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .system-info p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>质量检验系统</h1>
        <div class="subtitle">全面质量管理 · 数字化检验流程 · 实时数据监控</div>

        <!-- 统计信息区域 -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="pending-count">--</div>
                <div class="stat-label">待检验订单</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="inspected-count">--</div>
                <div class="stat-label">已检验订单</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rejected-count">--</div>
                <div class="stat-label">不合格产品</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-count">--</div>
                <div class="stat-label">总订单数</div>
            </div>
        </div>
    </div>

    <div class="nav-cards">
        <a href="/arrivals/" class="nav-card">
            <span class="nav-icon">📦</span>
            <div class="nav-title">采购到货信息</div>
            <div class="nav-description">
                查看所有采购订单的到货状态，处理待检验的采购项目，跟踪检验进度。
            </div>
        </a>

        <a href="/inspections/" class="nav-card">
            <span class="nav-icon">🔍</span>
            <div class="nav-title">质量检验记录</div>
            <div class="nav-description">
                浏览历史检验记录，查看检验结果详情，分析产品质量趋势。
            </div>
        </a>

        <a href="/rejections/" class="nav-card">
            <span class="nav-icon">⚠️</span>
            <div class="nav-title">不合格产品处理</div>
            <div class="nav-description">
                管理不合格产品记录，跟踪处理进度，记录最终处置方式。
            </div>
        </a>
    </div>

    <div class="system-info">
        <h3>系统概述</h3>
        <p>质量检验系统基于微服务架构构建，包含采购到货、质量检验、不合格产品处理三大核心模块。</p>
        <p>系统实现了从采购到货到质量检验，再到不合格产品处理的完整质量管理流程。</p>
        <p>🔹 <strong>采购到货服务</strong>：管理采购订单和到货信息，状态包括"待检验"、"检验中"、"检验合格"、"检验不合格"</p>
        <p>🔹 <strong>质量检验服务</strong>：执行产品质量检验，记录检验结果和不合格项</p>
        <p>🔹 <strong>不合格产品服务</strong>：处理检验不合格的产品，跟踪处置状态</p>
    </div>

    <script>
        // 获取统计数据的函数
        async function fetchStats() {
            try {
                // 获取采购订单数据
                const procurementResponse = await fetch('http://localhost:5001/api/purchase_orders');
                if (procurementResponse.ok) {
                    const orders = await procurementResponse.json();

                    // 计算统计数据
                    const pendingCount = orders.filter(order => order.status === '待检验').length;
                    const inspectedCount = orders.filter(order =>
                        order.status === '检验合格' || order.status === '检验不合格').length;
                    const totalCount = orders.length;

                    // 更新采购相关统计
                    document.getElementById('pending-count').textContent = pendingCount;
                    document.getElementById('inspected-count').textContent = inspectedCount;
                    document.getElementById('total-count').textContent = totalCount;
                }

                // 获取不合格产品数据
                const rejectionResponse = await fetch('http://localhost:5003/api/rejections');
                if (rejectionResponse.ok) {
                    const rejections = await rejectionResponse.json();
                    document.getElementById('rejected-count').textContent = rejections.length;
                }
            } catch (error) {
                console.error('获取统计数据失败:', error);
                // 如果API调用失败，显示默认值
                document.getElementById('pending-count').textContent = '0';
                document.getElementById('inspected-count').textContent = '0';
                document.getElementById('rejected-count').textContent = '0';
                document.getElementById('total-count').textContent = '0';
            }
        }

        // 页面加载时获取统计数据
        document.addEventListener('DOMContentLoaded', fetchStats);
    </script>
</body>
</html>